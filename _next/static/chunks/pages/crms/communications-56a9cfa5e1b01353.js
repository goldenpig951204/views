(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{9041:function(e,t,r){"use strict";r.d(t,{Z:function(){return I}});var n,i=r(63366),a=r(87462),s=r(67294),o=r(86010),l=r(94780),d=r(36622),c=r(29630),p=r(82586),m=r(59711),u=r(67074),x=r(1588),h=r(34867);function g(e){return(0,h.Z)("MuiInputAdornment",e)}let f=(0,x.Z)("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var Z=r(78884),b=r(85893);let v=["children","className","component","disablePointerEvents","disableTypography","position","variant"],y=(e,t)=>{let{ownerState:r}=e;return[t.root,t[`position${(0,d.Z)(r.position)}`],!0===r.disablePointerEvents&&t.disablePointerEvents,t[r.variant]]},j=e=>{let{classes:t,disablePointerEvents:r,hiddenLabel:n,position:i,size:a,variant:s}=e,o={root:["root",r&&"disablePointerEvents",i&&`position${(0,d.Z)(i)}`,s,n&&"hiddenLabel",a&&`size${(0,d.Z)(a)}`]};return(0,l.Z)(o,g,t)},w=(0,u.ZP)("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:y})(({theme:e,ownerState:t})=>(0,a.Z)({display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(e.vars||e).palette.action.active},"filled"===t.variant&&{[`&.${f.positionStart}&:not(.${f.hiddenLabel})`]:{marginTop:16}},"start"===t.position&&{marginRight:8},"end"===t.position&&{marginLeft:8},!0===t.disablePointerEvents&&{pointerEvents:"none"})),S=s.forwardRef(function(e,t){let r=(0,Z.Z)({props:e,name:"MuiInputAdornment"}),{children:l,className:d,component:u="div",disablePointerEvents:x=!1,disableTypography:h=!1,position:g,variant:f}=r,y=(0,i.Z)(r,v),S=(0,m.Z)()||{},I=f;f&&S.variant,S&&!I&&(I=S.variant);let R=(0,a.Z)({},r,{hiddenLabel:S.hiddenLabel,size:S.size,disablePointerEvents:x,position:g,variant:I}),C=j(R);return(0,b.jsx)(p.Z.Provider,{value:null,children:(0,b.jsx)(w,(0,a.Z)({as:u,ownerState:R,className:(0,o.Z)(C.root,d),ref:t},y,{children:"string"!=typeof l||h?(0,b.jsxs)(s.Fragment,{children:["start"===g?n||(n=(0,b.jsx)("span",{className:"notranslate",children:"â€‹"})):null,l]}):(0,b.jsx)(c.Z,{color:"text.secondary",children:l})}))})});var I=S},73688:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/crms/communications",function(){return r(71715)}])},71715:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return ee}});var n=r(85893),i=r(67294),a=r(61953),s=r(64631),o=r(33821),l=r(44731),d=r(67836),c=r(9041),p=r(29630),m=r(85214),u=r(81284),x=r(95309),h=r(63366),g=r(87462),f=r(86010),Z=r(94780),b=r(57742),v=r(67074),y=r(78884),j=r(1588),w=r(34867);function S(e){return(0,w.Z)("MuiListItemAvatar",e)}(0,j.Z)("MuiListItemAvatar",["root","alignItemsFlexStart"]);let I=["className"],R=e=>{let{alignItems:t,classes:r}=e;return(0,Z.Z)({root:["root","flex-start"===t&&"alignItemsFlexStart"]},S,r)},C=(0,v.ZP)("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver(e,t){let{ownerState:r}=e;return[t.root,"flex-start"===r.alignItems&&t.alignItemsFlexStart]}})(({ownerState:e})=>(0,g.Z)({minWidth:56,flexShrink:0},"flex-start"===e.alignItems&&{marginTop:8})),k=i.forwardRef(function(e,t){let r=(0,y.Z)({props:e,name:"MuiListItemAvatar"}),{className:a}=r,s=(0,h.Z)(r,I),o=i.useContext(b.Z),l=(0,g.Z)({},r,{alignItems:o.alignItems}),d=R(l);return(0,n.jsx)(C,(0,g.Z)({className:(0,f.Z)(d.root,a),ownerState:l,ref:t},s))});var N=r(97484);let _=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],P=e=>{let{classes:t,inset:r,primary:n,secondary:i,dense:a}=e;return(0,Z.Z)({root:["root",r&&"inset",a&&"dense",n&&i&&"multiline"],primary:["primary"],secondary:["secondary"]},N.L,t)},E=(0,v.ZP)("div",{name:"MuiListItemText",slot:"Root",overridesResolver(e,t){let{ownerState:r}=e;return[{[`& .${N.Z.primary}`]:t.primary},{[`& .${N.Z.secondary}`]:t.secondary},t.root,r.inset&&t.inset,r.primary&&r.secondary&&t.multiline,r.dense&&t.dense]}})(({ownerState:e})=>(0,g.Z)({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},e.primary&&e.secondary&&{marginTop:6,marginBottom:6},e.inset&&{paddingLeft:56})),L=i.forwardRef(function(e,t){let r=(0,y.Z)({props:e,name:"MuiListItemText"}),{children:a,className:s,disableTypography:o=!1,inset:l=!1,primary:d,primaryTypographyProps:c,secondary:m,secondaryTypographyProps:u}=r,x=(0,h.Z)(r,_),{dense:Z}=i.useContext(b.Z),v=null!=d?d:a,j=m,w=(0,g.Z)({},r,{disableTypography:o,inset:l,primary:!!v,secondary:!!j,dense:Z}),S=P(w);return null==v||v.type===p.Z||o||(v=(0,n.jsx)(p.Z,(0,g.Z)({variant:Z?"body2":"body1",className:S.primary,component:null!=c&&c.variant?void 0:"span",display:"block"},c,{children:v}))),null==j||j.type===p.Z||o||(j=(0,n.jsx)(p.Z,(0,g.Z)({variant:"body2",className:S.secondary,color:"text.secondary",display:"block"},u,{children:j}))),(0,n.jsxs)(E,(0,g.Z)({className:(0,f.Z)(S.root,s),ownerState:w,ref:t},x,{children:[v,j]}))});var T=r(21448),A=r(17288),M=r(21609),z=r(51964),B=r.n(z),D=r(5464);let W=e=>{let{children:t,hidden:r}=e;return r?(0,n.jsx)(a.Z,{sx:{height:"100%",overflow:"auto"},children:t}):(0,n.jsx)(B(),{options:{wheelPropagation:!1},children:t})},$=e=>{let{hidden:t,handleChatClick:r}=e,{user:h}=(0,A.a)(),[g,f]=(0,i.useState)(""),[Z,b]=(0,i.useState)([]);(0,i.useEffect)(()=>{let e=async()=>{let{data:e}=await D.Z.get("crms/communications/contacts",{params:{id:h._id}});b(e)};e()},[]);let v=e=>{b(Z.map(t=>(t._id===e._id&&(t.unSeenCount=0),t))),f(e._id),r(e)};return(0,n.jsxs)(s.ZP,{open:!0,variant:"permanent",sx:{zIndex:7,height:"100%",display:"block",position:"static","& .MuiDrawer-paper":{boxShadow:"none",overflow:"hidden",width:360,position:"static",borderTopLeftRadius:e=>e.shape.borderRadius,borderBottomLeftRadius:e=>e.shape.borderRadius},"& > .MuiBackdrop-root":{borderRadius:1,position:"absolute",zIndex:e=>e.zIndex.drawer-1}},children:[(0,n.jsxs)(a.Z,{sx:{px:5.5,py:3.5,display:"flex",alignItems:"center",borderBottom:e=>"1px solid ".concat(e.palette.divider)},children:[(0,n.jsx)(o.Z,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},sx:{mr:4.5},badgeContent:(0,n.jsx)(a.Z,{component:"span",sx:{width:8,height:8,borderRadius:"50%",color:"success.main",backgroundColor:"success.main",boxShadow:e=>"0 0 0 2px ".concat(e.palette.background.paper)}}),children:(0,n.jsx)(l.Z,{src:"/images/avatars/1.png",alt:h.firstName,sx:{width:40,height:40,cursor:"pointer"}})}),(0,n.jsx)(d.Z,{fullWidth:!0,size:"small",value:"",onChange(){},placeholder:"Search for contact...",sx:{"& .MuiInputBase-root":{borderRadius:5}},InputProps:{startAdornment:(0,n.jsx)(c.Z,{position:"start",children:(0,n.jsx)(M.Z,{icon:"mdi:magnify",fontSize:"1.25rem"})})}})]}),(0,n.jsx)(a.Z,{sx:{height:"calc(100vh - 240px)"},children:(0,n.jsx)(W,{hidden:t,children:(0,n.jsxs)(a.Z,{sx:{p:e=>e.spacing(5,3,3)},children:[(0,n.jsx)(p.Z,{variant:"h6",sx:{ml:2,mb:4,color:"primary.main"},children:"Contacts"}),(0,n.jsx)(m.Z,{sx:{p:0},children:Z.length>0&&Z.map((e,t)=>(0,n.jsx)(u.ZP,{disablePadding:!0,sx:{"&:not(:last-child)":{mb:1.5}},children:(0,n.jsxs)(x.Z,{disableRipple:!0,onClick(){v(e)},sx:{px:2.5,py:2.5,width:"100%",borderRadius:1,alignItems:"flex-start",...g==e._id&&{backgroundColor:e=>"".concat(e.palette.primary.main," !important")}},children:[(0,n.jsx)(k,{sx:{m:0},children:(0,n.jsx)(l.Z,{alt:"Avatar",src:"/images/avatars/2.png",sx:{width:40,height:40,outline:e=>"2px solid ".concat(e.palette.common.white,"}")}})}),(0,n.jsx)(L,{sx:{my:0,ml:4},primary:(0,n.jsx)(p.Z,{sx:{color:"text.secondary"},children:e.firstName+" "+e.lastName}),secondary:(0,n.jsx)(p.Z,{noWrap:!0,variant:"body2",sx:{color:"text.disabled"},children:e.role})}),(0,n.jsx)(a.Z,{sx:{display:"flex",alignItems:"flex-end",flexDirection:"column",justifyContent:"flex-start"},children:e.unSeenCount?(0,n.jsx)(T.Z,{color:"error",label:e.unSeenCount,sx:{mt:.5,height:18,fontWeight:600,fontSize:"0.75rem","& .MuiChip-label":{pt:.25,px:1.655}}}):null})]})},t))})]})})})]})};var F=r(75084);let G=(0,v.ZP)(B())(e=>{let{theme:t}=e;return{padding:t.spacing(5)}}),O=e=>{let{msgs:t,hidden:r,user:s,contact:o}=e,d=(0,i.useRef)(null);(0,i.useEffect)(()=>{t&&t.length&&c()},[t]);let c=()=>{d.current&&(r?d.current.scrollTop=Number.MAX_SAFE_INTEGER:d.current._container.scrollTop=Number.MAX_SAFE_INTEGER)},m=e=>{let{children:t}=e;return r?(0,n.jsx)(a.Z,{ref:d,sx:{p:5,height:"100%",overflowY:"auto",overflowX:"hidden"},children:t}):(0,n.jsx)(G,{ref:d,options:{wheelPropagation:!1},children:t})};return(0,n.jsx)(a.Z,{sx:{height:"calc(100vh - 310px)"},children:(0,n.jsx)(m,{children:t.map((e,r)=>{let i=e.user._id===s._id;return(0,n.jsxs)(a.Z,{sx:{display:"flex",flexDirection:i?"row-reverse":"row",mb:r!==t.length-1?3.75:void 0},children:[(0,n.jsx)("div",{children:(0,n.jsx)(l.Z,{skin:"light",color:"primary",sx:{width:"2rem",height:"2rem",fontSize:"0.875rem",ml:i?4:void 0,mr:i?void 0:4},...i?{}:{src:"/images/avatars/2.png",alt:o.firstName+" "+o.lastName},...i?{src:"/images/avatars/1.png",alt:s.firstName+" "+s.lastName}:{}})}),(0,n.jsx)(a.Z,{className:"chat-body",sx:{maxWidth:["calc(100% - 5.75rem)","75%","65%"]},children:(0,n.jsxs)(a.Z,{sx:{"&:not(:last-of-type)":{mb:3.5}},children:[(0,n.jsx)("div",{children:(0,n.jsx)(p.Z,{sx:{boxShadow:1,borderRadius:1,width:"fit-content",fontSize:"0.875rem",p:e=>e.spacing(3,4),ml:i?"auto":void 0,borderTopLeftRadius:i?void 0:0,borderTopRightRadius:i?0:void 0,color:i?"common.white":"text.primary",backgroundColor:i?"primary.main":"background.paper"},children:e.message})}),(0,n.jsx)(a.Z,{sx:{mt:1,display:"flex",alignItems:"center",justifyContent:i?"flex-end":"flex-start"},children:(0,n.jsx)(p.Z,{variant:"caption",sx:{color:"text.disabled"},children:e.createdAt?new Date(e.createdAt).toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}):null})})]},r)})]},r)})})})};var X=r(86501);let H=(0,v.ZP)(a.Z)(e=>{let{theme:t}=e;return{flexGrow:1,height:"100%",display:"flex",borderRadius:1,alignItems:"center",flexDirection:"column",justifyContent:"center",backgroundColor:t.palette.action.hover}}),U=(0,v.ZP)(a.Z)(e=>{let{theme:t}=e;return{display:"flex",borderRadius:8,alignItems:"center",boxShadow:t.shadows[1],padding:t.spacing(1.25,4),justifyContent:"space-between",backgroundColor:t.palette.background.paper}}),Y=(0,v.ZP)("form")(e=>{let{theme:t}=e;return{padding:t.spacing(0,5,5)}}),q=e=>{let{sender:t,hidden:r}=e,{user:s}=(0,A.a)(),[c,m]=(0,i.useState)([]),[u,x]=(0,i.useState)("");(0,i.useEffect)(()=>{let e=async()=>{let{data:e}=await D.Z.get("crms/communications/messages",{params:{user:s._id,sender:t._id}});m(e.messages)};e()},[t]);let h=async e=>{if(e.preventDefault(),u.trim()){let{data:r}=await D.Z.post("crms/communications/messages",{user:s._id,sender:t._id,message:u.trim()});r.status?m([...c,r.message]):X.ZP.error(r.msg)}x("")};return Object.keys(t).length?(0,n.jsxs)(a.Z,{sx:{flexGrow:1,width:"100%",height:"100%",backgroundColor:"action.hover"},children:[(0,n.jsx)(a.Z,{sx:{py:3,px:5,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:e=>"1px solid ".concat(e.palette.divider)},children:(0,n.jsx)(a.Z,{sx:{display:"flex",alignItems:"center"},children:(0,n.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",cursor:"pointer"},children:[(0,n.jsx)(o.Z,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},sx:{mr:4.5},badgeContent:(0,n.jsx)(a.Z,{component:"span",sx:{width:8,height:8,borderRadius:"50%",color:"success.main",boxShadow:e=>"0 0 0 2px ".concat(e.palette.background.paper),backgroundColor:"success.main"}}),children:(0,n.jsx)(l.Z,{src:"/images/avatars/2.png",alt:"Avatar",sx:{width:40,height:40}})}),(0,n.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"column"},children:[(0,n.jsx)(p.Z,{sx:{color:"text.secondary"},children:t.firstName+" "+t.lastName}),(0,n.jsx)(p.Z,{variant:"body2",sx:{color:"text.disabled"},children:t.role})]})]})})}),(0,n.jsx)(O,{hidden:r,msgs:c,user:s,contact:t}),(0,n.jsx)(Y,{onSubmit:h,children:(0,n.jsxs)(U,{children:[(0,n.jsx)(a.Z,{sx:{flexGrow:1,display:"flex",alignItems:"center"},children:(0,n.jsx)(d.Z,{fullWidth:!0,value:u,size:"small",placeholder:"Type your message hereâ€¦",onChange:e=>x(e.target.value),sx:{"& .MuiOutlinedInput-input":{pl:0},"& fieldset":{border:"0 !important"}}})}),(0,n.jsx)(a.Z,{sx:{display:"flex",alignItems:"center"},children:(0,n.jsx)(F.Z,{type:"submit",variant:"contained",children:"Send"})})]})})]}):(0,n.jsx)(H,{sx:{borderTopLeftRadius:0,borderBottomLeftRadius:0,height:"calc(100vh - 170px)"},children:(0,n.jsx)(l.Z,{sx:{mb:5,pt:8,pb:7,px:7.5,width:110,height:110,boxShadow:3,"& svg":{color:"action.active"},backgroundColor:"background.paper"},children:(0,n.jsx)(M.Z,{icon:"mdi:message-outline",fontSize:"3.125rem"})})})};var J=r(61225),K=r(62097),Q=r(94314);let V=()=>{let e=(0,K.Z)(),t=(0,J.Z)(e.breakpoints.down("lg")),[r,s]=(0,i.useState)({}),o=e=>{s(e)};return(0,n.jsxs)(a.Z,{className:"app-chat",sx:{width:"100%",display:"flex",borderRadius:1,overflow:"hidden",position:"relative",backgroundColor:"background.paper",boxShadow:6},children:[(0,n.jsx)($,{hidden:t,handleChatClick:o}),(0,n.jsx)(q,{hidden:t,sender:r})]})};V.authGuard=!0,V.getLayout=e=>(0,n.jsx)(Q.Z,{children:e});var ee=V}},function(e){e.O(0,[828,480,428,515,259,330,314,774,888,179],function(){return e(e.s=73688)}),_N_E=e.O()}]);